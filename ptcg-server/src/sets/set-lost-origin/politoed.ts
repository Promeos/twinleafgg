// This file was auto-generated by the card stub generator.
// Card effects were implemented by an agent.
// If you have any questions or feedback, reach out to @C4 in the discord.

import { PokemonCard } from '../../game/store/card/pokemon-card';
import { Stage, CardType } from '../../game/store/card/card-types';
import { PlayerType, StoreLike, State } from '../../game';
import { Effect } from '../../game/store/effects/effect';
import { WAS_ATTACK_USED } from '../../game/store/prefabs/prefabs';

export class Politoed extends PokemonCard {
  public stage: Stage = Stage.STAGE_2;
  public evolvesFrom: string = 'Poliwhirl';
  public cardType: CardType = W;
  public hp: number = 140;
  public weakness = [{ type: L }];
  public retreat = [C, C];

  public attacks = [
    {
      name: 'Lordly Songleader',
      cost: [C, C],
      damage: 10,
      damageCalculation: '+' as '+',
      text: 'If Poliwag is on your Bench, this attack does 60 more damage. If Poliwhirl is on your Bench, this attack does 90 more damage. If Poliwrath is on your Bench, this attack does 120 more damage.'
    },
    {
      name: 'Hydro Splash',
      cost: [W, C, C],
      damage: 100,
      text: ''
    }
  ];

  public regulationMark: string = 'F';
  public set: string = 'LOR';
  public setNumber: string = '32';
  public cardImage: string = 'assets/cardback.png';
  public name: string = 'Politoed';
  public fullName: string = 'Politoed (LOR 32)';

  public reduceEffect(store: StoreLike, state: State, effect: Effect): State {
    // Attack 1: Lordly Songleader
    // Ref: set-team-up/arcanine.ts (bench name check for damage bonus pattern)
    if (WAS_ATTACK_USED(effect, 0, this)) {
      const player = effect.player;

      let hasPoliwag = false;
      let hasPoliwhirl = false;
      let hasPoliwrath = false;

      player.forEachPokemon(PlayerType.BOTTOM_PLAYER, (cardList, card, target) => {
        if (target.slot === undefined) { return; }
        // Skip active - only check bench
        const pokemonCard = cardList.getPokemonCard();
        if (!pokemonCard) { return; }
        if (cardList === player.active) { return; }

        if (pokemonCard.name === 'Poliwag') { hasPoliwag = true; }
        if (pokemonCard.name === 'Poliwhirl') { hasPoliwhirl = true; }
        if (pokemonCard.name === 'Poliwrath') { hasPoliwrath = true; }
      });

      if (hasPoliwag) { effect.damage += 60; }
      if (hasPoliwhirl) { effect.damage += 90; }
      if (hasPoliwrath) { effect.damage += 120; }
    }

    return state;
  }
}
