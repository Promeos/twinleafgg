// This file was auto-generated by the card stub generator.
// Card effects were implemented by an agent.
// If you have any questions or feedback, reach out to @C4 in the discord.

import { TrainerCard } from '../../game/store/card/trainer-card';
import { TrainerType, CardTag } from '../../game/store/card/card-types';
import { StoreLike, State } from '../../game';
import { Effect } from '../../game/store/effects/effect';
import { TrainerTargetEffect } from '../../game/store/effects/play-card-effects';

export class MoonAndSunBadge extends TrainerCard {
  public trainerType: TrainerType = TrainerType.TOOL;
  public regulationMark: string = 'E';
  public set: string = 'EVS';
  public setNumber: string = '151';
  public cardImage: string = 'assets/cardback.png';
  public name: string = 'Moon & Sun Badge';
  public fullName: string = 'Moon & Sun Badge EVS';
  public text: string = 'If the Pokémon V this card is attached to has "Espeon" or "Umbreon" in its name, whenever your opponent plays a Supporter card from their hand, prevent all effects of that card done to that Pokémon. You may play any number of Item cards during your turn. Attach a Pokémon Tool to 1 of your Pokémon that doesn\'t already have a Pokémon Tool attached.';

  public reduceEffect(store: StoreLike, state: State, effect: Effect): State {
    // Prevent Supporter effects targeting Espeon V or Umbreon V with this badge
    // Ref: set-silver-tempest/leafy-camo-poncho.ts (TrainerTargetEffect + tool check pattern)
    if (
      effect instanceof TrainerTargetEffect &&
      effect.trainerCard?.trainerType === TrainerType.SUPPORTER &&
      effect.target &&
      effect.target.cards.includes(this)
    ) {
      const attachedPokemon = effect.target.getPokemonCard();
      if (
        attachedPokemon &&
        attachedPokemon.tags.includes(CardTag.POKEMON_V) &&
        (attachedPokemon.name.includes('Espeon') || attachedPokemon.name.includes('Umbreon'))
      ) {
        effect.target = undefined;
      }
    }

    return state;
  }
}
