// This file was auto-generated by the card stub generator.
// Card effects were implemented by an agent.
// If you have any questions or feedback, reach out to @C4 in the discord.

import { TrainerCard } from '../../game/store/card/trainer-card';
import { TrainerType, CardTag } from '../../game/store/card/card-types';
import { StoreLike, State } from '../../game';
import { Effect } from '../../game/store/effects/effect';
import { ApplyWeaknessEffect } from '../../game/store/effects/attack-effects';
import { CheckRetreatCostEffect } from '../../game/store/effects/check-effects';
import { IS_TOOL_BLOCKED } from '../../game/store/prefabs/prefabs';
import { StateUtils } from '../../game/store/state-utils';

export class SnowLeafBadge extends TrainerCard {
  public trainerType: TrainerType = TrainerType.TOOL;
  public regulationMark: string = 'E';
  public set: string = 'EVS';
  public setNumber: string = '159';
  public cardImage: string = 'assets/cardback.png';
  public name: string = 'Snow Leaf Badge';
  public fullName: string = 'Snow Leaf Badge EVS';
  public text: string = 'If the Pokémon V this card is attached to has "Leafeon" or "Glaceon" in its name, it has no Retreat Cost and no Weakness. You may play any number of Item cards during your turn. Attach a Pokémon Tool to 1 of your Pokémon that doesn\'t already have a Pokémon Tool attached.';

  public reduceEffect(store: StoreLike, state: State, effect: Effect): State {
    // Ref: set-sword-and-shield/air-balloon.ts (CheckRetreatCostEffect + tool check pattern)
    //      set-vivid-voltage/swoobat.ts (ApplyWeaknessEffect.ignoreWeakness pattern)

    // No Retreat Cost for Leafeon V / Glaceon V with this badge
    if (effect instanceof CheckRetreatCostEffect && effect.player.active.tools.includes(this)) {
      if (IS_TOOL_BLOCKED(store, state, effect.player, this)) {
        return state;
      }

      const attachedPokemon = effect.player.active.getPokemonCard();
      if (attachedPokemon &&
          attachedPokemon.tags.includes(CardTag.POKEMON_V) &&
          (attachedPokemon.name.includes('Leafeon') || attachedPokemon.name.includes('Glaceon'))) {
        effect.cost = [];
      }
    }

    // No Weakness for Leafeon V / Glaceon V with this badge
    if (effect instanceof ApplyWeaknessEffect && effect.target.tools.includes(this)) {
      const player = StateUtils.findOwner(state, effect.target);

      if (IS_TOOL_BLOCKED(store, state, player, this)) {
        return state;
      }

      const attachedPokemon = effect.target.getPokemonCard();
      if (attachedPokemon &&
          attachedPokemon.tags.includes(CardTag.POKEMON_V) &&
          (attachedPokemon.name.includes('Leafeon') || attachedPokemon.name.includes('Glaceon'))) {
        effect.ignoreWeakness = true;
      }
    }

    return state;
  }
}
