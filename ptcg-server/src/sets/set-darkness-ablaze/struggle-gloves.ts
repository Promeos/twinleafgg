// This file was auto-generated by the card stub generator.
// Card effects were implemented by an agent.
// If you have any questions or feedback, reach out to @C4 in the discord.

import { TrainerCard } from '../../game/store/card/trainer-card';
import { TrainerType } from '../../game/store/card/card-types';
import { StoreLike, State, StateUtils } from '../../game';
import { Effect } from '../../game/store/effects/effect';
import { DealDamageEffect } from '../../game/store/effects/attack-effects';
import { IS_TOOL_BLOCKED } from '../../game/store/prefabs/prefabs';
import { CheckPokemonTypeEffect } from '../../game/store/effects/check-effects';

export class StruggleGloves extends TrainerCard {
  public trainerType: TrainerType = TrainerType.TOOL;
  public regulationMark: string = 'D';
  public set: string = 'DAA';
  public setNumber: string = '171';
  public cardImage: string = 'assets/cardback.png';
  public name: string = 'Struggle Gloves';
  public fullName: string = 'Struggle Gloves DAA';
  public text: string = 'Attach a Pokémon Tool to 1 of your Pokémon that doesn\'t already have a Pokémon Tool attached. If the Pokémon this card is attached to has Weakness to your opponent\'s Active Pokémon\'s type, its attacks do 30 more damage to your opponent\'s Active Pokémon (before applying Weakness and Resistance). You may play any number of Item cards during your turn.';

  public reduceEffect(store: StoreLike, state: State, effect: Effect): State {
    // Ref: set-shining-fates/rusted-sword.ts (TOOL_ACTIVE_DAMAGE_BONUS - DealDamageEffect + tool check pattern)
    if (!(effect instanceof DealDamageEffect) || !effect.source.tools.includes(this)) {
      return state;
    }

    if (IS_TOOL_BLOCKED(store, state, effect.player, this)) {
      return state;
    }

    const sourcePokemon = effect.source.getPokemonCard();
    if (sourcePokemon === undefined) {
      return state;
    }

    const opponent = StateUtils.getOpponent(state, effect.player);
    // Only applies to attacks targeting opponent's active
    if (effect.target !== opponent.active || effect.damage <= 0) {
      return state;
    }

    // Check opponent's active Pokemon type(s)
    const checkOpponentType = new CheckPokemonTypeEffect(opponent.active);
    store.reduceEffect(state, checkOpponentType);
    const opponentTypes = checkOpponentType.cardTypes;

    // Check if the source Pokemon has weakness to any of the opponent's active types
    const hasWeakness = sourcePokemon.weakness.some(w => opponentTypes.includes(w.type));
    if (hasWeakness) {
      effect.damage += 30;
    }

    return state;
  }
}
