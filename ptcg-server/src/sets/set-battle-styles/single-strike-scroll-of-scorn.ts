// This file was auto-generated by the card stub generator.
// Card effects were implemented by an agent.
// If you have any questions or feedback, reach out to @C4 in the discord.

import { Attack, PokemonCard } from '../../game';
import { CardTag, CardType, TrainerType } from '../../game/store/card/card-types';
import { TrainerCard } from '../../game/store/card/trainer-card';
import { Effect } from '../../game/store/effects/effect';
import { CheckPokemonAttacksEffect } from '../../game/store/effects/check-effects';
import { AttackEffect } from '../../game/store/effects/game-effects';
import { IS_TOOL_BLOCKED } from '../../game/store/prefabs/prefabs';

import { State } from '../../game/store/state/state';
import { StoreLike } from '../../game/store/store-like';

export class SingleStrikeScrollOfScorn extends TrainerCard {
  public trainerType: TrainerType = TrainerType.TOOL;
  public tags = [CardTag.SINGLE_STRIKE];
  public regulationMark: string = 'E';
  public set: string = 'BST';
  public setNumber: string = '133';
  public cardImage: string = 'assets/cardback.png';
  public name: string = 'Single Strike Scroll of Scorn';
  public fullName: string = 'Single Strike Scroll of Scorn BST';
  public text: string = 'Attach a Pokémon Tool to 1 of your Pokémon that doesn\'t already have a Pokémon Tool attached. The Single Strike Pokémon this card is attached to can use the attack on this card. (You still need the necessary Energy to use this attack.) You may play any number of Item cards during your turn.';

  public attacks: Attack[] = [{
    name: 'Furious Anger',
    cost: [CardType.FIGHTING],
    damage: 10,
    damageCalculation: '+',
    text: 'This attack does 10 more damage for each damage counter on this Pokémon.'
  }];

  // Ref: set-battle-styles/rapid-strike-scroll-of-swirls.ts (tool attack pattern)
  public reduceEffect(store: StoreLike, state: State, effect: Effect): State {
    // Add attack to Single Strike Pokemon that has this tool
    if (effect instanceof CheckPokemonAttacksEffect && effect.player.active.getPokemonCard()?.tools.includes(this) &&
      !effect.attacks.includes(this.attacks[0])) {

      if (IS_TOOL_BLOCKED(store, state, effect.player, this)) { return state; }

      effect.attacks.push(this.attacks[0]);
    }

    // Furious Anger: only usable by Single Strike Pokemon with this tool
    if (effect instanceof AttackEffect && effect.attack === this.attacks[0]) {
      const player = effect.player;

      if (!player.active.cards.some(c => c instanceof PokemonCard && c.tags.includes(CardTag.SINGLE_STRIKE))) {
        return state;
      }

      // 10 more damage for each damage counter on this Pokemon
      const damage = player.active.damage;
      effect.damage += damage;
    }

    return state;
  }
}
