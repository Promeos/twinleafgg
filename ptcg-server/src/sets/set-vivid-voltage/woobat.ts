// This file was auto-generated by the card stub generator.
// Card effects were implemented by an agent.
// If you have any questions or feedback, reach out to @C4 in the discord.

import { PokemonCard } from '../../game/store/card/pokemon-card';
import { Stage, CardType } from '../../game/store/card/card-types';
import { StoreLike, State, StateUtils } from '../../game';
import { Effect } from '../../game/store/effects/effect';
import { WAS_ATTACK_USED } from '../../game/store/prefabs/prefabs';
import { DealDamageEffect, PutDamageEffect } from '../../game/store/effects/attack-effects';

export class Woobat extends PokemonCard {
  public stage: Stage = Stage.BASIC;
  public cardType: CardType = P;
  public hp: number = 60;
  public weakness = [{ type: L }];
  public resistance = [{ type: F, value: -30 }];
  public retreat = [C];

  public attacks = [
    {
      name: 'Unamplified Soundwave',
      cost: [P],
      damage: 0,
      text: 'This attack does 30 damage to each of your opponent\'s Pokémon. (Don\'t apply Weakness and Resistance for Benched Pokémon.) If you have any cards in your hand, this attack does nothing.'
    }
  ];

  public regulationMark: string = 'D';
  public set: string = 'VIV';
  public setNumber: string = '73';
  public cardImage: string = 'assets/cardback.png';
  public name: string = 'Woobat';
  public fullName: string = 'Woobat VIV';

  public reduceEffect(store: StoreLike, state: State, effect: Effect): State {
    // Attack 1: Unamplified Soundwave
    // Ref: set-vivid-voltage/pincurchin.ts (spread damage to active + bench), set-darkness-ablaze/salazzle.ts (hand check)
    if (WAS_ATTACK_USED(effect, 0, this)) {
      const player = effect.player;

      // If player has any cards in hand, does nothing
      if (player.hand.cards.length > 0) {
        effect.damage = 0;
        return state;
      }

      const opponent = StateUtils.getOpponent(state, player);

      // 30 damage to active (apply W/R)
      const damageActive = new DealDamageEffect(effect, 30);
      damageActive.target = opponent.active;
      store.reduceEffect(state, damageActive);

      // 30 damage to benched (no W/R)
      opponent.bench.forEach(benched => {
        if (benched.cards.length > 0) {
          const benchDamage = new PutDamageEffect(effect, 30);
          benchDamage.target = benched;
          store.reduceEffect(state, benchDamage);
        }
      });
    }

    return state;
  }
}
